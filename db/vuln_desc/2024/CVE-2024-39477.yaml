configurations:
- nodes:
  - cpeMatch:
    - criteria: cpe:2.3:o:linux:linux_kernel:*:*:*:*:*:*:*:*
      matchCriteriaId: 54EDFD02-25E6-4BC8-9AD0-0A59881F400A
      versionEndExcluding: 6.9.5
      versionStartIncluding: '6.9'
      vulnerable: true
    - criteria: cpe:2.3:o:linux:linux_kernel:6.10.0:rc1:*:*:*:*:*:*
      matchCriteriaId: C40DD2D9-90E3-4E95-9F1A-E7C680F11F2A
      vulnerable: true
    - criteria: cpe:2.3:o:linux:linux_kernel:6.10.0:rc2:*:*:*:*:*:*
      matchCriteriaId: 54D5209E-E390-45C5-A5D1-C9EDB40819F7
      vulnerable: true
    negate: false
    operator: OR
cveTags: []
descriptions:
- lang: en
  value: 'In the Linux kernel, the following vulnerability has been resolved:


    mm/hugetlb: do not call vma_add_reservation upon ENOMEM


    sysbot reported a splat [1] on __unmap_hugepage_range().  This is because

    vma_needs_reservation() can return -ENOMEM if

    allocate_file_region_entries() fails to allocate the file_region struct

    for the reservation.


    Check for that and do not call vma_add_reservation() if that is the case,

    otherwise region_abort() and region_del() will see that we do not have any

    file_regions.


    If we detect that vma_needs_reservation() returned -ENOMEM, we clear the

    hugetlb_restore_reserve flag as if this reservation was still consumed, so

    free_huge_folio() will not increment the resv count.


    [1] https://lore.kernel.org/linux-mm/0000000000004096100617c58d54@google.com/T/#ma5983bc1ab18a54910da83416b3f89f3c7ee43aa'
- lang: es
  value: "En el kernel de Linux, se resolvi\xF3 la siguiente vulnerabilidad: mm/hugetlb:\
    \ no llame a vma_add_reservation cuando ENOMEM sysbot inform\xF3 un splat [1]\
    \ en __unmap_hugepage_range(). Esto se debe a que vma_needs_reservation() puede\
    \ devolver -ENOMEM si allocate_file_region_entries() no puede asignar la estructura\
    \ file_region para la reserva. Verifique eso y no llame a vma_add_reservation()\
    \ si ese es el caso; de lo contrario, region_abort() y region_del() ver\xE1n que\
    \ no tenemos ning\xFAn file_regions. Si detectamos que vma_needs_reservation()\
    \ devolvi\xF3 -ENOMEM, borramos el indicador hugetlb_restore_reserve como si esta\
    \ reserva todav\xEDa estuviera consumida, por lo que free_huge_folio() no incrementar\xE1\
    \ el recuento de resv. [1] https://lore.kernel.org/linux-mm/0000000000004096100617c58d54@google.com/T/#ma5983bc1ab18a54910da83416b3f89f3c7ee43aa"
id: CVE-2024-39477
lastModified: '2024-07-08T17:11:05.790'
metrics:
  cvssMetricV31:
  - cvssData:
      attackComplexity: LOW
      attackVector: LOCAL
      availabilityImpact: HIGH
      baseScore: 5.5
      baseSeverity: MEDIUM
      confidentialityImpact: NONE
      integrityImpact: NONE
      privilegesRequired: LOW
      scope: UNCHANGED
      userInteraction: NONE
      vectorString: CVSS:3.1/AV:L/AC:L/PR:L/UI:N/S:U/C:N/I:N/A:H
      version: '3.1'
    exploitabilityScore: 1.8
    impactScore: 3.6
    source: nvd@nist.gov
    type: Primary
published: '2024-07-05T07:15:10.413'
references:
- source: 416baaa9-dc9f-4396-8d5f-8c081fb06d67
  tags:
  - Mailing List
  - Patch
  url: https://git.kernel.org/stable/c/8daf9c702ee7f825f0de8600abff764acfedea13
- source: 416baaa9-dc9f-4396-8d5f-8c081fb06d67
  tags:
  - Mailing List
  - Patch
  url: https://git.kernel.org/stable/c/aa998f9dcb34c28448f86e8f5490f20d5eb0eac7
sourceIdentifier: 416baaa9-dc9f-4396-8d5f-8c081fb06d67
vulnStatus: Analyzed
weaknesses:
- description:
  - lang: en
    value: CWE-770
  source: nvd@nist.gov
  type: Primary
