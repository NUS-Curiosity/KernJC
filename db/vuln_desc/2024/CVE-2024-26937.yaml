descriptions:
- lang: en
  value: 'In the Linux kernel, the following vulnerability has been resolved:


    drm/i915/gt: Reset queue_priority_hint on parking


    Originally, with strict in order execution, we could complete execution

    only when the queue was empty. Preempt-to-busy allows replacement of an

    active request that may complete before the preemption is processed by

    HW. If that happens, the request is retired from the queue, but the

    queue_priority_hint remains set, preventing direct submission until

    after the next CS interrupt is processed.


    This preempt-to-busy race can be triggered by the heartbeat, which will

    also act as the power-management barrier and upon completion allow us to

    idle the HW. We may process the completion of the heartbeat, and begin

    parking the engine before the CS event that restores the

    queue_priority_hint, causing us to fail the assertion that it is MIN.


    <3>[  166.210729] __engine_park:283 GEM_BUG_ON(engine->sched_engine->queue_priority_hint
    != (-((int)(~0U >> 1)) - 1))

    <0>[  166.210781] Dumping ftrace buffer:

    <0>[  166.210795] ---------------------------------

    ...

    <0>[  167.302811] drm_fdin-1097      2..s1. 165741070us : trace_ports: 0000:00:02.0
    rcs0: promote { ccid:20 1217:2 prio 0 }

    <0>[  167.302861] drm_fdin-1097      2d.s2. 165741072us : execlists_submission_tasklet:
    0000:00:02.0 rcs0: preempting last=1217:2, prio=0, hint=2147483646

    <0>[  167.302928] drm_fdin-1097      2d.s2. 165741072us : __i915_request_unsubmit:
    0000:00:02.0 rcs0: fence 1217:2, current 0

    <0>[  167.302992] drm_fdin-1097      2d.s2. 165741073us : __i915_request_submit:
    0000:00:02.0 rcs0: fence 3:4660, current 4659

    <0>[  167.303044] drm_fdin-1097      2d.s1. 165741076us : execlists_submission_tasklet:
    0000:00:02.0 rcs0: context:3 schedule-in, ccid:40

    <0>[  167.303095] drm_fdin-1097      2d.s1. 165741077us : trace_ports: 0000:00:02.0
    rcs0: submit { ccid:40 3:4660* prio 2147483646 }

    <0>[  167.303159] kworker/-89       11..... 165741139us : i915_request_retire.part.0:
    0000:00:02.0 rcs0: fence c90:2, current 2

    <0>[  167.303208] kworker/-89       11..... 165741148us : __intel_context_do_unpin:
    0000:00:02.0 rcs0: context:c90 unpin

    <0>[  167.303272] kworker/-89       11..... 165741159us : i915_request_retire.part.0:
    0000:00:02.0 rcs0: fence 1217:2, current 2

    <0>[  167.303321] kworker/-89       11..... 165741166us : __intel_context_do_unpin:
    0000:00:02.0 rcs0: context:1217 unpin

    <0>[  167.303384] kworker/-89       11..... 165741170us : i915_request_retire.part.0:
    0000:00:02.0 rcs0: fence 3:4660, current 4660

    <0>[  167.303434] kworker/-89       11d..1. 165741172us : __intel_context_retire:
    0000:00:02.0 rcs0: context:1216 retire runtime: { total:56028ns, avg:56028ns }

    <0>[  167.303484] kworker/-89       11..... 165741198us : __engine_park: 0000:00:02.0
    rcs0: parked

    <0>[  167.303534]   <idle>-0         5d.H3. 165741207us : execlists_irq_handler:
    0000:00:02.0 rcs0: semaphore yield: 00000040

    <0>[  167.303583] kworker/-89       11..... 165741397us : __intel_context_retire:
    0000:00:02.0 rcs0: context:1217 retire runtime: { total:325575ns, avg:0ns }

    <0>[  167.303756] kworker/-89       11..... 165741777us : __intel_context_retire:
    0000:00:02.0 rcs0: context:c90 retire runtime: { total:0ns, avg:0ns }

    <0>[  167.303806] kworker/-89       11..... 165742017us : __engine_park: __engine_park:283
    GEM_BUG_ON(engine->sched_engine->queue_priority_hint != (-((int)(~0U >> 1)) -
    1))

    <0>[  167.303811] ---------------------------------

    <4>[  167.304722] ------------[ cut here ]------------

    <2>[  167.304725] kernel BUG at drivers/gpu/drm/i915/gt/intel_engine_pm.c:283!

    <4>[  167.304731] invalid opcode: 0000 [#1] PREEMPT SMP NOPTI

    <4>[  167.304734] CPU: 11 PID: 89 Comm: kworker/11:1 Tainted: G        W          6.8.0-rc2-CI_DRM_14193-gc655e0fd2804+
    #1

    <4>[  167.304736] Hardware name: Intel Corporation Rocket Lake Client Platform/RocketLake
    S UDIMM 6L RVP, BIOS RKLSFWI1.R00.3173.A03.2204210138 04/21/2022

    <4>[  167.304738] Workqueue: i915-unordered retire_work_handler [i915]

    <4>[  16

    ---truncated---'
- lang: es
  value: "En el kernel de Linux, se resolvi\xF3 la siguiente vulnerabilidad: drm/i915/gt:\
    \ Restablecer queue_priority_hint al estacionar Originalmente, con ejecuci\xF3\
    n en orden estricto, pod\xEDamos completar la ejecuci\xF3n solo cuando la cola\
    \ estaba vac\xEDa. La preferencia por ocupaci\xF3n permite el reemplazo de una\
    \ solicitud activa que puede completarse antes de que HW procese la preferencia.\
    \ Si eso sucede, la solicitud se retira de la cola, pero queue_priority_hint permanece\
    \ configurada, lo que impide el env\xEDo directo hasta despu\xE9s de que se procese\
    \ la siguiente interrupci\xF3n de CS. Esta ejecuci\xF3n de prioridad a ocupaci\xF3\
    n puede ser desencadenada por el latido del coraz\xF3n, que tambi\xE9n actuar\xE1\
    \ como barrera de administraci\xF3n de energ\xEDa y, al finalizar, nos permitir\xE1\
    \ dejar el HW inactivo. Podemos procesar la finalizaci\xF3n del latido y comenzar\
    \ a estacionar el motor antes del evento CS que restaura queue_priority_hint,\
    \ lo que hace que falle la afirmaci\xF3n de que es MIN. &lt;3&gt;[ 166.210729]\
    \ __engine_park:283 GEM_BUG_ON(motor-&gt;sched_engine-&gt;queue_priority_hint\
    \ != (-((int)(~0U &gt;&gt; 1)) - 1)) &lt;0&gt;[ 166.210781] Volviendo buffer ftrace:\
    \ &lt;0 &gt;[ 166.210795] --------------------------------- ... &lt;0&gt;[ 167.302811]\
    \ drm_fdin-1097 2 ..s1. 165741070us: trace_ports: 0000:00:02.0 rcs0: promover\
    \ { ccid:20 1217:2 prio 0 } &lt;0&gt;[ 167.302861] drm_fdin-1097 2d.s2. 165741072us:\
    \ execlists_submission_tasklet: 0000:00:02.0 rcs0: apropiaci\xF3n del \xFAltimo\
    \ = 1217:2, prio = 0, sugerencia = 2147483646 &lt;0&gt; [167.302928] drm_fdin-1097\
    \ 2d.s2. 165741072us: __i915_request_unsubmit: 0000:00:02.0 rcs0: valla 1217:2,\
    \ actual 0 &lt;0&gt;[ 167.302992] drm_fdin-1097 2d.s2. 165741073us: __i915_request_submit:\
    \ 0000:00:02.0 rcs0: valla 3:4660, actual 4659 &lt;0&gt;[ 167.303044] drm_fdin-1097\
    \ 2d.s1. 165741076us: execlists_submission_tasklet: 0000:00:02.0 rcs0: contexto:3\
    \ programaci\xF3n de entrada, ccid:40 &lt;0&gt;[ 167.303095] drm_fdin-1097 2d.s1.\
    \ 165741077us: trace_ports: 0000:00:02.0 rcs0: enviar { ccid:40 3:4660* prio 2147483646\
    \ } &lt;0&gt;[ 167.303159] kworker/-89 11..... 165741139us: i915_request_retire.part.0:\
    \ 0000:00 :02.0 rcs0: valla c90:2, actual 2 &lt;0&gt;[ 167.303208] kworker/-89\
    \ 11..... 165741148us : __intel_context_do_unpin: 0000:00:02.0 rcs0: contexto:c90\
    \ desanclar &lt;0&gt;[ 167.303272] kworker/ -89 11..... 165741159us: i915_request_retire.part.0:\
    \ 0000:00:02.0 rcs0: valla 1217:2, actual 2 &lt;0&gt;[ 167.303321] kworker/-89\
    \ 11..... 165741166us: __intel_context_do_unpin: 0000:00:02.0 rcs0: contexto:1217\
    \ desanclar &lt;0&gt;[ 167.303384] kworker/-89 11..... 165741170us: i915_request_retire.part.0:\
    \ 0000:00:02.0 rcs0: valla 3:4660, actual 4660 &lt; 0&gt;[ 167.303434] ktrabajador/-89\
    \ 11d..1. 165741172us: __intel_context_retire: 0000:00:02.0 rcs0: contexto:1216\
    \ retirar tiempo de ejecuci\xF3n: { total:56028ns, avg:56028ns } &lt;0&gt;[ 167.303484]\
    \ kworker/-89 11..... 165741198us: __engine_park: 0000:00: 02.0 rcs0: estacionado\
    \ &lt;0&gt;[ 167.303534] -0 5d.H3. 165741207us: execlists_irq_handler: 0000:00:02.0\
    \ rcs0: rendimiento del sem\xE1foro: 00000040 &lt;0&gt;[ 167.303583] kworker/-89\
    \ 11..... 165741397us: __intel_context_retire: 0000:00:02.0 s0: contexto: 1217\
    \ retirar el tiempo de ejecuci\xF3n: {total :325575ns, promedio:0ns } &lt;0&gt;[\
    \ 167.303756] kworker/-89 11..... 165741777us : __intel_context_retire: 0000:00:02.0\
    \ rcs0: contexto:c90 retirar tiempo de ejecuci\xF3n: { total:0ns, promedio:0ns\
    \ } &lt; 0&gt;[ 167.303806] kworker/-89 11..... 165742017us : __engine_park: __engine_park:283\
    \ GEM_BUG_ON(motor-&gt;sched_engine-&gt;queue_priority_hint != (-((int)(~0U &gt;&gt;\
    \ 1)) - 1) ) &lt;0&gt;[ 167.303811] --------------------------------- &lt;4&gt;[\
    \ 167.304722] ---- --------[ cortar aqu\xED ]------------ &lt;2&gt;[ 167.304725]\
    \ ERROR del kernel en drivers/gpu/drm/i915/gt/intel_engine_pm.c:283! &lt;4&gt;[\
    \ 167.304731] c\xF3digo de operaci\xF3n no v\xE1lido: 0000 [#1] PREEMPT SMP NOPTI\
    \ &lt;4&gt;[ 167.304734] CPU: 11 PID: 89 Comm: kworker/11:1 Contaminado: GW 6.8.0-rc2-CI_DRM_14193-gc655e0fd2804+\
    \ #1 &lt;4&gt;[ 167.304736] ---truncado---"
id: CVE-2024-26937
lastModified: '2024-06-25T22:15:26.440'
metrics: {}
published: '2024-05-01T06:15:08.960'
references:
- source: 416baaa9-dc9f-4396-8d5f-8c081fb06d67
  url: https://git.kernel.org/stable/c/3b031e4fcb2740988143c303f81f69f18ce86325
- source: 416baaa9-dc9f-4396-8d5f-8c081fb06d67
  url: https://git.kernel.org/stable/c/4a3859ea5240365d21f6053ee219bb240d520895
- source: 416baaa9-dc9f-4396-8d5f-8c081fb06d67
  url: https://git.kernel.org/stable/c/67944e6db656bf1e986aa2a359f866f851091f8a
- source: 416baaa9-dc9f-4396-8d5f-8c081fb06d67
  url: https://git.kernel.org/stable/c/7eab7b021835ae422c38b968d5cc60e99408fb62
- source: 416baaa9-dc9f-4396-8d5f-8c081fb06d67
  url: https://git.kernel.org/stable/c/8fd9b0ce8c26533fe4d5d15ea15bbf7b904b611c
- source: 416baaa9-dc9f-4396-8d5f-8c081fb06d67
  url: https://git.kernel.org/stable/c/ac9b6b3e8d1237136c8ebf0fa1ce037dd7e2948f
- source: 416baaa9-dc9f-4396-8d5f-8c081fb06d67
  url: https://git.kernel.org/stable/c/aed034866a08bb7e6e34d50a5629a4d23fe83703
- source: 416baaa9-dc9f-4396-8d5f-8c081fb06d67
  url: https://git.kernel.org/stable/c/fe34587acc995e7b1d7a5d3444a0736721ec32b3
- source: 416baaa9-dc9f-4396-8d5f-8c081fb06d67
  url: https://lists.debian.org/debian-lts-announce/2024/06/msg00017.html
sourceIdentifier: 416baaa9-dc9f-4396-8d5f-8c081fb06d67
vulnStatus: Awaiting Analysis
