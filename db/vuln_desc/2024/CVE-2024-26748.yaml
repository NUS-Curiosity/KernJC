cveTags: []
descriptions:
- lang: en
  value: 'In the Linux kernel, the following vulnerability has been resolved:


    usb: cdns3: fix memory double free when handle zero packet


    829  if (request->complete) {

    830          spin_unlock(&priv_dev->lock);

    831          usb_gadget_giveback_request(&priv_ep->endpoint,

    832                                    request);

    833          spin_lock(&priv_dev->lock);

    834  }

    835

    836  if (request->buf == priv_dev->zlp_buf)

    837      cdns3_gadget_ep_free_request(&priv_ep->endpoint, request);


    Driver append an additional zero packet request when queue a packet, which

    length mod max packet size is 0. When transfer complete, run to line 831,

    usb_gadget_giveback_request() will free this requestion. 836 condition is

    true, so cdns3_gadget_ep_free_request() free this request again.


    Log:


    [ 1920.140696][  T150] BUG: KFENCE: use-after-free read in cdns3_gadget_giveback+0x134/0x2c0
    [cdns3]

    [ 1920.140696][  T150]

    [ 1920.151837][  T150] Use-after-free read at 0x000000003d1cd10b (in kfence-#36):

    [ 1920.159082][  T150]  cdns3_gadget_giveback+0x134/0x2c0 [cdns3]

    [ 1920.164988][  T150]  cdns3_transfer_completed+0x438/0x5f8 [cdns3]


    Add check at line 829, skip call usb_gadget_giveback_request() if it is

    additional zero length packet request. Needn''t call

    usb_gadget_giveback_request() because it is allocated in this driver.'
- lang: es
  value: "En el kernel de Linux, se ha resuelto la siguiente vulnerabilidad: usb:\
    \ cdns3: corrige la memoria doblemente libre cuando se maneja el paquete cero\
    \ 829 if (request-&gt;complete) { 830 spin_unlock(&amp;priv_dev-&gt;lock); 831\
    \ usb_gadget_giveback_request(&amp;priv_ep-&gt;endpoint, solicitud 832); 833 spin_lock(&amp;priv_dev-&gt;lock);\
    \ 834 } 835 836 if (solicitud-&gt;buf == priv_dev-&gt;zlp_buf) 837 cdns3_gadget_ep_free_request(&amp;priv_ep-&gt;endpoint,\
    \ solicitud); El controlador agrega una solicitud de paquete cero adicional cuando\
    \ pone en cola un paquete, cuya longitud mod tama\xF1o m\xE1ximo del paquete es\
    \ 0. Cuando se complete la transferencia, ejecute la l\xEDnea 831, usb_gadget_giveback_request()\
    \ liberar\xE1 esta solicitud. La condici\xF3n 836 es verdadera, por lo que cdns3_gadget_ep_free_request()\
    \ libera esta solicitud nuevamente. Registro: [1920.140696][ T150] ERROR: KFENCE:\
    \ lectura de uso despu\xE9s de liberaci\xF3n en cdns3_gadget_giveback+0x134/0x2c0\
    \ [cdns3] [ 1920.140696][ T150] [ 1920.151837][ T150] Lectura de uso despu\xE9\
    s de liberaci\xF3n en 0x000000003d 1cd10b (en kcerca -#36): [ 1920.159082][ T150]\
    \ cdns3_gadget_giveback+0x134/0x2c0 [cdns3] [ 1920.164988][ T150] cdns3_transfer_completed+0x438/0x5f8\
    \ [cdns3] Agregar cheque en la l\xEDnea 829, omitir llamada usb_gadget_giveback_\
    \ request() si tiene una longitud cero adicional solicitud de paquete. No es necesario\
    \ llamar a usb_gadget_giveback_request() porque est\xE1 asignado en este controlador."
id: CVE-2024-26748
lastModified: '2024-06-25T21:15:58.480'
metrics: {}
published: '2024-04-03T17:15:51.727'
references:
- source: 416baaa9-dc9f-4396-8d5f-8c081fb06d67
  url: https://git.kernel.org/stable/c/1e204a8e9eb514e22a6567fb340ebb47df3f3a48
- source: 416baaa9-dc9f-4396-8d5f-8c081fb06d67
  url: https://git.kernel.org/stable/c/3a2a909942b5335b7ea66366d84261b3ed5f89c8
- source: 416baaa9-dc9f-4396-8d5f-8c081fb06d67
  url: https://git.kernel.org/stable/c/5fd9e45f1ebcd57181358af28506e8a661a260b3
- source: 416baaa9-dc9f-4396-8d5f-8c081fb06d67
  url: https://git.kernel.org/stable/c/70e8038813f9d3e72df966748ebbc40efe466019
- source: 416baaa9-dc9f-4396-8d5f-8c081fb06d67
  url: https://git.kernel.org/stable/c/92d20406a3d4ff3e8be667c79209dc9ed31df5b3
- source: 416baaa9-dc9f-4396-8d5f-8c081fb06d67
  url: https://git.kernel.org/stable/c/9a52b694b066f299d8b9800854a8503457a8b64c
- source: 416baaa9-dc9f-4396-8d5f-8c081fb06d67
  url: https://git.kernel.org/stable/c/aad6132ae6e4809e375431f8defd1521985e44e7
- source: 416baaa9-dc9f-4396-8d5f-8c081fb06d67
  url: https://lists.debian.org/debian-lts-announce/2024/06/msg00017.html
sourceIdentifier: 416baaa9-dc9f-4396-8d5f-8c081fb06d67
vulnStatus: Awaiting Analysis
