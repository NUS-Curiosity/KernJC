configurations:
- nodes:
  - cpeMatch:
    - criteria: cpe:2.3:o:linux:linux_kernel:*:*:*:*:*:*:*:*
      matchCriteriaId: F8F0E46F-AE23-4E3C-94C2-982292314C2D
      versionEndExcluding: 6.6.41
      versionStartIncluding: '6.5'
      vulnerable: true
    - criteria: cpe:2.3:o:linux:linux_kernel:*:*:*:*:*:*:*:*
      matchCriteriaId: AB2E8DEC-CFD5-4C2B-981D-E7E45A36C352
      versionEndExcluding: 6.9.10
      versionStartIncluding: '6.7'
      vulnerable: true
    negate: false
    operator: OR
cveTags: []
descriptions:
- lang: en
  value: "In the Linux kernel, the following vulnerability has been resolved:\n\n\
    scsi: ufs: core: Fix ufshcd_clear_cmd racing issue\n\nWhen ufshcd_clear_cmd is\
    \ racing with the completion ISR, the completed tag\nof the request's mq_hctx\
    \ pointer will be set to NULL by the ISR.  And\nufshcd_clear_cmd's call to ufshcd_mcq_req_to_hwq\
    \ will get NULL pointer KE.\nReturn success when the request is completed by ISR\
    \ because sq does not\nneed cleanup.\n\nThe racing flow is:\n\nThread A\nufshcd_err_handler\t\
    \t\t\t\tstep 1\n\tufshcd_try_to_abort_task\n\t\tufshcd_cmd_inflight(true)\t\t\
    step 3\n\t\tufshcd_clear_cmd\n\t\t\t...\n\t\t\tufshcd_mcq_req_to_hwq\n\t\t\tblk_mq_unique_tag\n\
    \t\t\t\trq->mq_hctx->queue_num\tstep 5\n\nThread B\nufs_mtk_mcq_intr(cq complete\
    \ ISR)\t\t\tstep 2\n\tscsi_done\n\t\t...\n\t\t__blk_mq_free_request\n\t\t\trq->mq_hctx\
    \ = NULL;\t\tstep 4\n\nBelow is KE back trace:\n\n  ufshcd_try_to_abort_task:\
    \ cmd pending in the device. tag = 6\n  Unable to handle kernel NULL pointer dereference\
    \ at virtual address 0000000000000194\n   pc : [0xffffffd589679bf8] blk_mq_unique_tag+0x8/0x14\n\
    \   lr : [0xffffffd5862f95b4] ufshcd_mcq_sq_cleanup+0x6c/0x1cc [ufs_mediatek_mod_ise]\n\
    \   Workqueue: ufs_eh_wq_0 ufshcd_err_handler [ufs_mediatek_mod_ise]\n   Call\
    \ trace:\n    dump_backtrace+0xf8/0x148\n    show_stack+0x18/0x24\n    dump_stack_lvl+0x60/0x7c\n\
    \    dump_stack+0x18/0x3c\n    mrdump_common_die+0x24c/0x398 [mrdump]\n    ipanic_die+0x20/0x34\
    \ [mrdump]\n    notify_die+0x80/0xd8\n    die+0x94/0x2b8\n    __do_kernel_fault+0x264/0x298\n\
    \    do_page_fault+0xa4/0x4b8\n    do_translation_fault+0x38/0x54\n    do_mem_abort+0x58/0x118\n\
    \    el1_abort+0x3c/0x5c\n    el1h_64_sync_handler+0x54/0x90\n    el1h_64_sync+0x68/0x6c\n\
    \    blk_mq_unique_tag+0x8/0x14\n    ufshcd_clear_cmd+0x34/0x118 [ufs_mediatek_mod_ise]\n\
    \    ufshcd_try_to_abort_task+0x2c8/0x5b4 [ufs_mediatek_mod_ise]\n    ufshcd_err_handler+0xa7c/0xfa8\
    \ [ufs_mediatek_mod_ise]\n    process_one_work+0x208/0x4fc\n    worker_thread+0x228/0x438\n\
    \    kthread+0x104/0x1d4\n    ret_from_fork+0x10/0x20"
- lang: es
  value: "En el kernel de Linux, se resolvi\xF3 la siguiente vulnerabilidad: scsi:\
    \ ufs: core: solucione el problema de ejecuci\xF3n de ufshcd_clear_cmd Cuando\
    \ ufshcd_clear_cmd corre con el ISR de finalizaci\xF3n, el ISR establecer\xE1\
    \ la etiqueta completada del puntero mq_hctx de la solicitud en NULL. Y la llamada\
    \ de ufshcd_clear_cmd a ufshcd_mcq_req_to_hwq obtendr\xE1 un puntero NULL KE.\
    \ Devuelve el \xE9xito cuando ISR completa la solicitud porque sq no necesita\
    \ limpieza. El flujo de ejecuci\xF3n es: Hilo A ufshcd_err_handler paso 1 ufshcd_try_to_abort_task\
    \ ufshcd_cmd_inflight(true) paso 3 ufshcd_clear_cmd ... ufshcd_mcq_req_to_hwq\
    \ blk_mq_unique_tag rq-&gt;mq_hctx-&gt;queue_num paso 5 Hilo ufs_mtk_mcq_int r(cq\
    \ completar ISR) paso 2 scsi_done ... __blk_mq_free_request rq-&gt; mq_hctx =\
    \ NULO; paso 4 A continuaci\xF3n se muestra el rastreo de KE: ufshcd_try_to_abort_task:\
    \ cmd pendiente en el dispositivo. etiqueta = 6 No se puede manejar la desreferencia\
    \ del puntero NULL del kernel en la direcci\xF3n virtual 0000000000000194 pc:\
    \ [0xffffffd589679bf8] blk_mq_unique_tag+0x8/0x14 lr: [0xffffffd5862f95b4] ufshcd_mcq_sq_cleanup+0x6c/0x1cc\
    \ _mod_ise] Cola de trabajo: ufs_eh_wq_0 ufshcd_err_handler [ufs_mediatek_mod_ise]\
    \ Seguimiento de llamadas: dump_backtrace+0xf8 /0x148 show_stack+0x18/0x24 dump_stack_lvl+0x60/0x7c\
    \ dump_stack+0x18/0x3c mrdump_common_die+0x24c/0x398 [mrdump] ipanic_die+0x20/0x34\
    \ [mrdump] notify_die+0x80/0xd8 die+0x94/0x2b8 __do_kernel_fault+0x264/0x298 do_page_fault+\
    \ 0xa4/0x4b8 do_translation_fault+0x38/0x54 do_mem_abort+0x58/0x118 el1_abort+0x3c/0x5c\
    \ el1h_64_sync_handler+0x54/0x90 el1h_64_sync+0x68/0x6c blk_mq_unique_tag+0x8/0x14\
    \ clear_cmd+0x34/0x118 [ufs_mediatek_mod_ise] ufshcd_try_to_abort_task+0x2c8/0x5b4\
    \ [ufs_mediatek_mod_ise] ufshcd_err_handler +0xa7c/0xfa8 [ufs_mediatek_mod_ise]\
    \ process_one_work+0x208/0x4fc trabajador_hilo+0x228/0x438 kthread+0x104/0x1d4\
    \ ret_from_fork+0x10/0x20"
id: CVE-2024-41054
lastModified: '2024-08-22T14:11:42.053'
metrics:
  cvssMetricV31:
  - cvssData:
      attackComplexity: LOW
      attackVector: LOCAL
      availabilityImpact: HIGH
      baseScore: 5.5
      baseSeverity: MEDIUM
      confidentialityImpact: NONE
      integrityImpact: NONE
      privilegesRequired: LOW
      scope: UNCHANGED
      userInteraction: NONE
      vectorString: CVSS:3.1/AV:L/AC:L/PR:L/UI:N/S:U/C:N/I:N/A:H
      version: '3.1'
    exploitabilityScore: 1.8
    impactScore: 3.6
    source: nvd@nist.gov
    type: Primary
published: '2024-07-29T15:15:13.557'
references:
- source: 416baaa9-dc9f-4396-8d5f-8c081fb06d67
  tags:
  - Patch
  url: https://git.kernel.org/stable/c/11d81233f4ebe6907b12c79ad7d8787aa4db0633
- source: 416baaa9-dc9f-4396-8d5f-8c081fb06d67
  tags:
  - Patch
  url: https://git.kernel.org/stable/c/9307a998cb9846a2557fdca286997430bee36a2a
- source: 416baaa9-dc9f-4396-8d5f-8c081fb06d67
  tags:
  - Patch
  url: https://git.kernel.org/stable/c/bed0896008334eeee4b4bfd7150491ca098cbf72
sourceIdentifier: 416baaa9-dc9f-4396-8d5f-8c081fb06d67
vulnStatus: Analyzed
weaknesses:
- description:
  - lang: en
    value: CWE-476
  source: nvd@nist.gov
  type: Primary
