configurations:
- nodes:
  - cpeMatch:
    - criteria: cpe:2.3:o:linux:linux_kernel:*:*:*:*:*:*:*:*
      matchCriteriaId: 76CAFB30-218D-4245-9302-53CC23E96072
      versionEndExcluding: 5.10.143
      versionStartIncluding: '5.10'
      vulnerable: true
    - criteria: cpe:2.3:o:linux:linux_kernel:*:*:*:*:*:*:*:*
      matchCriteriaId: C440CED2-FE3C-495D-839C-857FFC6F523A
      versionEndExcluding: 5.15.68
      versionStartIncluding: '5.11'
      vulnerable: true
    - criteria: cpe:2.3:o:linux:linux_kernel:*:*:*:*:*:*:*:*
      matchCriteriaId: B4895A99-6E1B-4C76-A510-FDED00AD7D29
      versionEndExcluding: 5.19.9
      versionStartIncluding: '5.16'
      vulnerable: true
    negate: false
    operator: OR
descriptions:
- lang: en
  value: 'In the Linux kernel, the following vulnerability has been resolved:


    IB/core: Fix a nested dead lock as part of ODP flow


    Fix a nested dead lock as part of ODP flow by using mmput_async().


    From the below call trace [1] can see that calling mmput() once we have

    the umem_odp->umem_mutex locked as required by

    ib_umem_odp_map_dma_and_lock() might trigger in the same task the

    exit_mmap()->__mmu_notifier_release()->mlx5_ib_invalidate_range() which

    may dead lock when trying to lock the same mutex.


    Moving to use mmput_async() will solve the problem as the above

    exit_mmap() flow will be called in other task and will be executed once

    the lock will be available.


    [1]

    [64843.077665] task:kworker/u133:2  state:D stack:    0 pid:80906 ppid:

    2 flags:0x00004000

    [64843.077672] Workqueue: mlx5_ib_page_fault mlx5_ib_eqe_pf_action [mlx5_ib]

    [64843.077719] Call Trace:

    [64843.077722]  <TASK>

    [64843.077724]  __schedule+0x23d/0x590

    [64843.077729]  schedule+0x4e/0xb0

    [64843.077735]  schedule_preempt_disabled+0xe/0x10

    [64843.077740]  __mutex_lock.constprop.0+0x263/0x490

    [64843.077747]  __mutex_lock_slowpath+0x13/0x20

    [64843.077752]  mutex_lock+0x34/0x40

    [64843.077758]  mlx5_ib_invalidate_range+0x48/0x270 [mlx5_ib]

    [64843.077808]  __mmu_notifier_release+0x1a4/0x200

    [64843.077816]  exit_mmap+0x1bc/0x200

    [64843.077822]  ? walk_page_range+0x9c/0x120

    [64843.077828]  ? __cond_resched+0x1a/0x50

    [64843.077833]  ? mutex_lock+0x13/0x40

    [64843.077839]  ? uprobe_clear_state+0xac/0x120

    [64843.077860]  mmput+0x5f/0x140

    [64843.077867]  ib_umem_odp_map_dma_and_lock+0x21b/0x580 [ib_core]

    [64843.077931]  pagefault_real_mr+0x9a/0x140 [mlx5_ib]

    [64843.077962]  pagefault_mr+0xb4/0x550 [mlx5_ib]

    [64843.077992]  pagefault_single_data_segment.constprop.0+0x2ac/0x560

    [mlx5_ib]

    [64843.078022]  mlx5_ib_eqe_pf_action+0x528/0x780 [mlx5_ib]

    [64843.078051]  process_one_work+0x22b/0x3d0

    [64843.078059]  worker_thread+0x53/0x410

    [64843.078065]  ? process_one_work+0x3d0/0x3d0

    [64843.078073]  kthread+0x12a/0x150

    [64843.078079]  ? set_kthread_struct+0x50/0x50

    [64843.078085]  ret_from_fork+0x22/0x30

    [64843.078093]  </TASK>'
- lang: es
  value: "En el kernel de Linux, se resolvi\xF3 la siguiente vulnerabilidad: IB/core:\
    \ corrija un bloqueo anidado como parte del flujo ODP. Corrija un bloqueo anidado\
    \ como parte del flujo ODP usando mmput_async(). En el siguiente seguimiento de\
    \ llamadas [1] se puede ver que llamar a mmput() una vez que tenemos umem_odp-&gt;umem_mutex\
    \ bloqueado como lo requiere ib_umem_odp_map_dma_and_lock() podr\xEDa desencadenar\
    \ en la misma tarea exit_mmap()-&gt;__mmu_notifier_release()-&gt;mlx5_ib_invalidate_range()\
    \ lo que puede bloquearse al intentar bloquear el mismo mutex. Pasar a utilizar\
    \ mmput_async() resolver\xE1 el problema ya que el flujo exit_mmap() anterior\
    \ se llamar\xE1 en otra tarea y se ejecutar\xE1 una vez que el bloqueo est\xE9\
    \ disponible. [1] [64843.077665] tarea:kworker/u133:2 estado:D pila: 0 pid:80906\
    \ ppid: 2 banderas:0x00004000 [64843.077672] Cola de trabajo: mlx5_ib_page_fault\
    \ mlx5_ib_eqe_pf_action [mlx5_ib] 9] Seguimiento de llamadas: [64843.077722] \
    \ [64843.077724] __schedule+0x23d/0x590 [64843.077729] Schedule+0x4e/0xb0 [64843.077735]\
    \ Schedule_preempt_disabled+0xe/0x10 [64843.077740] __mutex_lock.constprop.0+0x263/0x\
    \ 490 [64843.077747] __mutex_lock_slowpath+0x13/0x20 [64843.077752] mutex_lock+0x34\
    \ /0x40 [64843.077758] mlx5_ib_invalidate_range+0x48/0x270 [mlx5_ib] [64843.077808]\
    \ __mmu_notifier_release+0x1a4/0x200 [64843.077816] exit_mmap+0x1bc/0x200 822]\
    \ ? walk_page_range+0x9c/0x120 [64843.077828] ? __cond_resched+0x1a/0x50 [64843.077833]\
    \ ? mutex_lock+0x13/0x40 [64843.077839] ? uprobe_clear_state+0xac/0x120 [64843.077860]\
    \ mmput+0x5f/0x140 [64843.077867] ib_umem_odp_map_dma_and_lock+0x21b/0x580 [ib_core]\
    \ [64843.077931] pagefault_real_mr+0x9a/0x 140 [mlx5_ib] [64843.077962] pagefault_mr+0xb4/0x550\
    \ [mlx5_ib] [64843.077992] pagefault_single_data_segment .constprop.0+0x2ac/0x560\
    \ [mlx5_ib] [64843.078022] mlx5_ib_eqe_pf_action+0x528/0x780 [mlx5_ib] [64843.078051]\
    \ Process_one_work+0x22b/0x3d0 [64843.078059] x53/0x410 [64843.078065] ? proceso_one_work+0x3d0/0x3d0\
    \ [64843.078073] kthread+0x12a/0x150 [64843.078079] ? set_kthread_struct+0x50/0x50\
    \ [64843.078085] ret_from_fork+0x22/0x30 [64843.078093] "
id: CVE-2022-48675
lastModified: '2024-05-23T20:33:42.183'
metrics:
  cvssMetricV31:
  - cvssData:
      attackComplexity: LOW
      attackVector: LOCAL
      availabilityImpact: HIGH
      baseScore: 5.5
      baseSeverity: MEDIUM
      confidentialityImpact: NONE
      integrityImpact: NONE
      privilegesRequired: LOW
      scope: UNCHANGED
      userInteraction: NONE
      vectorString: CVSS:3.1/AV:L/AC:L/PR:L/UI:N/S:U/C:N/I:N/A:H
      version: '3.1'
    exploitabilityScore: 1.8
    impactScore: 3.6
    source: nvd@nist.gov
    type: Primary
published: '2024-05-03T15:15:07.627'
references:
- source: 416baaa9-dc9f-4396-8d5f-8c081fb06d67
  tags:
  - Patch
  url: https://git.kernel.org/stable/c/819110054b14d7272b4188db997a3d80f75ab785
- source: 416baaa9-dc9f-4396-8d5f-8c081fb06d67
  tags:
  - Patch
  url: https://git.kernel.org/stable/c/83c43fd872e32c8071d5582eb7c40f573a8342f3
- source: 416baaa9-dc9f-4396-8d5f-8c081fb06d67
  tags:
  - Patch
  url: https://git.kernel.org/stable/c/85eaeb5058f0f04dffb124c97c86b4f18db0b833
- source: 416baaa9-dc9f-4396-8d5f-8c081fb06d67
  tags:
  - Patch
  url: https://git.kernel.org/stable/c/e8de6cb5755eae7b793d8c00c8696c8667d44a7f
sourceIdentifier: 416baaa9-dc9f-4396-8d5f-8c081fb06d67
vulnStatus: Analyzed
weaknesses:
- description:
  - lang: en
    value: CWE-667
  source: nvd@nist.gov
  type: Primary
