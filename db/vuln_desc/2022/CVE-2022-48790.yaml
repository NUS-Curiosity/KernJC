configurations:
- nodes:
  - cpeMatch:
    - criteria: cpe:2.3:o:linux:linux_kernel:*:*:*:*:*:*:*:*
      matchCriteriaId: BED6719E-2004-42C8-8CA4-4E4CD159B63F
      versionEndExcluding: 4.19.231
      vulnerable: true
    - criteria: cpe:2.3:o:linux:linux_kernel:*:*:*:*:*:*:*:*
      matchCriteriaId: FB33213E-1A45-4E3B-A129-58AAA2EB921D
      versionEndExcluding: 5.4.181
      versionStartIncluding: '4.20'
      vulnerable: true
    - criteria: cpe:2.3:o:linux:linux_kernel:*:*:*:*:*:*:*:*
      matchCriteriaId: DAD66A9A-8D06-48D1-8AA8-FC060496FF53
      versionEndExcluding: 5.10.102
      versionStartIncluding: '5.5'
      vulnerable: true
    - criteria: cpe:2.3:o:linux:linux_kernel:*:*:*:*:*:*:*:*
      matchCriteriaId: D098AA16-8E21-4EB7-AE2F-1EEB58E1A3A3
      versionEndExcluding: 5.15.25
      versionStartIncluding: '5.11'
      vulnerable: true
    - criteria: cpe:2.3:o:linux:linux_kernel:*:*:*:*:*:*:*:*
      matchCriteriaId: 0D327234-5D4A-43DC-A6DF-BCA0CEBEC039
      versionEndExcluding: 5.16.11
      versionStartIncluding: '5.16'
      vulnerable: true
    negate: false
    operator: OR
cveTags: []
descriptions:
- lang: en
  value: "In the Linux kernel, the following vulnerability has been resolved:\n\n\
    nvme: fix a possible use-after-free in controller reset during load\n\nUnlike\
    \ .queue_rq, in .submit_async_event drivers may not check the ctrl\nreadiness\
    \ for AER submission. This may lead to a use-after-free\ncondition that was observed\
    \ with nvme-tcp.\n\nThe race condition may happen in the following scenario:\n\
    1. driver executes its reset_ctrl_work\n2. -> nvme_stop_ctrl - flushes ctrl async_event_work\n\
    3. ctrl sends AEN which is received by the host, which in turn\n   schedules AEN\
    \ handling\n4. teardown admin queue (which releases the queue socket)\n5. AEN\
    \ processed, submits another AER, calling the driver to submit\n6. driver attempts\
    \ to send the cmd\n==> use-after-free\n\nIn order to fix that, add ctrl state\
    \ check to validate the ctrl\nis actually able to accept the AER submission.\n\
    \nThis addresses the above race in controller resets because the driver\nduring\
    \ teardown should:\n1. change ctrl state to RESETTING\n2. flush async_event_work\
    \ (as well as other async work elements)\n\nSo after 1,2, any other AER command\
    \ will find the\nctrl state to be RESETTING and bail out without submitting the\
    \ AER."
- lang: es
  value: "En el kernel de Linux, se resolvi\xF3 la siguiente vulnerabilidad: nvme:\
    \ corrige un posible use-after-free en el reinicio del controlador durante la\
    \ carga. A diferencia de .queue_rq, en .submit_async_event es posible que los\
    \ controladores no verifiquen la preparaci\xF3n de Ctrl para el env\xEDo de AER.\
    \ Esto puede provocar una condici\xF3n de use-after-free que se observ\xF3 con\
    \ nvme-tcp. La condici\xF3n de ejecuci\xF3n puede ocurrir en el siguiente escenario:\
    \ 1. el controlador ejecuta su reset_ctrl_work 2. -&gt; nvme_stop_ctrl - vac\xED\
    a ctrl async_event_work 3. ctrl env\xEDa AEN que es recibido por el host, que\
    \ a su vez programa el manejo de AEN 4. desmontaje de la cola de administraci\xF3\
    n (que libera el socket de la cola) 5. AEN procesado, env\xEDa otro AER, llamando\
    \ al controlador para enviar 6. el controlador intenta enviar el cmd ==&gt; use-after-free\
    \ Para solucionar eso, agregue la verificaci\xF3n de estado de ctrl para validar\
    \ que ctrl es realmente capaz de aceptar la presentaci\xF3n de la ARE. Esto soluciona\
    \ la ejecuci\xF3n anterior en los reinicios del controlador porque el controlador\
    \ durante el desmontaje debe: 1. cambiar el estado de Ctrl a RESTABLECER 2. vaciar\
    \ async_event_work (as\xED como otros elementos de trabajo as\xEDncronos) Entonces,\
    \ despu\xE9s de 1,2, cualquier otro comando AER encontrar\xE1 el estado de Ctrl\
    \ estar RESETING y rescatar sin presentar la AER."
id: CVE-2022-48790
lastModified: '2024-08-07T20:06:57.857'
metrics:
  cvssMetricV31:
  - cvssData:
      attackComplexity: HIGH
      attackVector: LOCAL
      availabilityImpact: HIGH
      baseScore: 7.0
      baseSeverity: HIGH
      confidentialityImpact: HIGH
      integrityImpact: HIGH
      privilegesRequired: LOW
      scope: UNCHANGED
      userInteraction: NONE
      vectorString: CVSS:3.1/AV:L/AC:H/PR:L/UI:N/S:U/C:H/I:H/A:H
      version: '3.1'
    exploitabilityScore: 1.0
    impactScore: 5.9
    source: nvd@nist.gov
    type: Primary
published: '2024-07-16T12:15:03.843'
references:
- source: 416baaa9-dc9f-4396-8d5f-8c081fb06d67
  tags:
  - Patch
  url: https://git.kernel.org/stable/c/0ead57ceb21bbf15963b4874c2ac67143455382f
- source: 416baaa9-dc9f-4396-8d5f-8c081fb06d67
  tags:
  - Patch
  url: https://git.kernel.org/stable/c/0fa0f99fc84e41057cbdd2efbfe91c6b2f47dd9d
- source: 416baaa9-dc9f-4396-8d5f-8c081fb06d67
  tags:
  - Patch
  url: https://git.kernel.org/stable/c/70356b756a58704e5c8818cb09da5854af87e765
- source: 416baaa9-dc9f-4396-8d5f-8c081fb06d67
  tags:
  - Patch
  url: https://git.kernel.org/stable/c/9e956a2596ae276124ef0d96829c013dd0faf861
- source: 416baaa9-dc9f-4396-8d5f-8c081fb06d67
  tags:
  - Patch
  url: https://git.kernel.org/stable/c/a25e460fbb0340488d119fb2e28fe3f829b7417e
- source: 416baaa9-dc9f-4396-8d5f-8c081fb06d67
  tags:
  - Patch
  url: https://git.kernel.org/stable/c/e043fb5a0336ee74614e26f0d9f36f1f5bb6d606
sourceIdentifier: 416baaa9-dc9f-4396-8d5f-8c081fb06d67
vulnStatus: Analyzed
weaknesses:
- description:
  - lang: en
    value: CWE-416
  source: nvd@nist.gov
  type: Primary
